@*
    Analysis Results Section
*@
@{
    var analysisResult = Context.Session.GetString("AnalysisResult");
    var analysisError = Context.Session.GetString("AnalysisError");
    var analysisId = Context.Session.GetString("AnalysisId");
}

<!-- Analysis Results - Always include but conditionally show/hide -->
<div class="analysis-results mt-4" id="analysisResultsSection" data-analysis-id="@(string.IsNullOrEmpty(analysisId) ? "" : analysisId)" @(string.IsNullOrEmpty(analysisId) && string.IsNullOrEmpty(analysisResult) && string.IsNullOrEmpty(analysisError) ? "class=\"hidden-analysis\"" : "")>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5>üîç AI Analysis Results</h5>
        <div class="btn-group" role="group" id="analysisButtonsContainer">
            <!-- Buttons will be injected here by JS if needed -->
            <button type="button" class="btn workflow-btn-secondary" id="newAnalysisBtn" onclick="resetAnalysisUI()" style="display: none;">
                <i class="fas fa-plus"></i> New Analysis
            </button>
        </div>
    </div>

    <!-- Progress Message Display (for SignalR updates) -->
    <div id="progressContainer" style="display: none;">
        <div class="workflow-alert workflow-alert-info mb-3">
            <div class="d-flex align-items-center">
                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                <span id="progressMessage">Starting analysis...</span>
            </div>
        </div>
    </div>

    <!-- Analysis Result Display (for SignalR results) -->
    <div id="analysisResult" style="display: none;">
        <div class="workflow-card mb-3">
            <div class="workflow-card-header workflow-card-header-success">
                <h6 class="mb-0">Analysis Results</h6>
            </div>
            <div class="workflow-card-body">
                <pre id="result" class="analysis-text workflow-pre" style="white-space: pre-wrap; font-family: monospace;"></pre>
            </div>
        </div>
    </div>

    <!-- Bottom Panel View -->
    <div id="bottomPanelView">
        @if (!string.IsNullOrEmpty(analysisResult))
        {
            <div class="workflow-card">
                <div class="workflow-card-header workflow-card-header-success">
                    <h6 class="mb-0">Analysis Results</h6>
                </div>
                <div class="workflow-card-body">
                    <pre class="analysis-text workflow-pre" style="white-space: pre-wrap; font-family: monospace;">@analysisResult</pre>
                </div>
            </div>
        }
    </div>

    <!-- Side Panel View (initially hidden) -->
    <div id="sidePanelView" style="display: none;">
        <div class="workflow-alert workflow-alert-info">
            <div class="d-flex align-items-center">
                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                <span>Loading side-panel view...</span>
            </div>
        </div>
    </div>
</div>

@if (!string.IsNullOrEmpty(analysisError))
{
    <div class="workflow-alert workflow-alert-danger mt-3" id="analysisErrorSection">
        ‚ùå @analysisError
    </div>
}