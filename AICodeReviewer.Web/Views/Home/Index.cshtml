@{
    ViewData["Title"] = "Home Page";
    var analysisResult = Context.Session.GetString("AnalysisResult");
    var analysisError = Context.Session.GetString("AnalysisError");
    var analysisId = Context.Session.GetString("AnalysisId");
}

<div class="text-center workflow-main-container">
    <h1 class="display-4">Welcome</h1>
    
    @if (ViewBag.BranchInfo != null)
    {
        <div class="git-status">
            @if (ViewBag.IsError)
            {
                <div class="workflow-alert workflow-alert-warning" role="alert">
                    ‚ö†Ô∏è @ViewBag.BranchInfo
                </div>
            }
            else
            {
                <div class="workflow-alert workflow-alert-success" role="alert">
                    üåø Current branch: <strong>@ViewBag.BranchInfo</strong>
                </div>
            }
        </div>
    }
    
    <!-- CSS Grid Workflow Container -->
    <div class="workflow-grid-container">
        
        <!-- Step 1: Requirements -->
        @await Html.PartialAsync("_WorkflowStepRequirements")
        
        <!-- Step 2: Language -->
        @await Html.PartialAsync("_WorkflowStepLanguage")
        
        <!-- Step 3: Repository -->
        @await Html.PartialAsync("_WorkflowStepRepository")
        
        <!-- Step 4: Analysis -->
        @await Html.PartialAsync("_WorkflowStepAnalysis")
        
        <!-- Step 5: Model -->
        @await Html.PartialAsync("_WorkflowStepModel")
        
    </div>

    <!-- Start Analysis Button - Below Grid -->
    @await Html.PartialAsync("_StartAnalysisButton")
    
    <!-- Git Diff Display (Outside workflow-container) -->
    @await Html.PartialAsync("_GitDiffSection")
    
    <!-- Analysis Info Sections -->
    @await Html.PartialAsync("_AnalysisInfoSections")
    
    <!-- Analysis Results -->
    @await Html.PartialAsync("_AnalysisResults")
    
    <!-- Directory Browser Modal -->
    @await Html.PartialAsync("_DirectoryBrowserModal")
</div>

<!-- SignalR Client Library -->
<script src="https://unpkg.com/@@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>

<!-- Analysis View Functions -->
<script src="~/js/analysis-view.js"></script>

<!-- Analysis Type Functions -->
<script src="~/js/analysis-type.js"></script>

<!-- Model Selector Functions -->
<script src="~/js/model-selector.js"></script>

<!-- Horizontal Workflow Functions -->
<script src="~/js/workflow-horizontal.js"></script>

<!-- Workflow Integration Functions -->
<script src="~/js/workflow-integration.js"></script>

<script>
    // Set global variables for the new JavaScript modules
    document.addEventListener('DOMContentLoaded', function() {
        // Set analysis data for analysis-view.js
        window.analysisId = '@(analysisId ?? "")';
        window.analysisResult = '@(Html.Raw(analysisResult?.Replace("'", "\\'") ?? ""))';
        window.analysisError = '@(Html.Raw(analysisError?.Replace("'", "\\'") ?? ""))';
        
        // Set repository path for analysis-type.js
        window.repositoryPath = '@Html.Raw(ViewBag.RepositoryPath)';
    });
</script>